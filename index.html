<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CROP CURE</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #e8f5e9;
    }

    /* ---------------- LOGIN / SIGNUP PAGE ---------------- */
    #loginPage {
      width: 100%;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .login-box {
      background: white;
      padding: 30px;
      border-radius: 12px;
      width: 350px;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .login-box input, .login-box select {
      width: 90%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #aaa;
    }

    .login-btn {
      width: 95%;
      padding: 12px;
      margin-top: 15px;
      background: #2e7d32;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    .login-btn:hover {
      background: #1b5e20;
    }

    /* ---------------- MAIN PAGE ---------------- */
    #mainPage {
      display: none;
    }

    header {
      background: #2e7d32;
      padding: 20px;
      color: #fff;
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    header img {
      width: 50px;
      margin-right: 15px;
    }

    /* LOGOUT BUTTON */
    #logoutBtn {
      position: absolute;
      right: 20px;
      top: 15px;
      background: #c62828;
      color: white;
      border: none;
      padding: 5px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    #logoutBtn:hover {
      background: #8e0000;
    }

    /* LANGUAGE SELECT */
    #mainLanguageSelect {
      position: absolute;
      right: 120px;
      top: 15px;
      padding: 5px;
      border-radius: 5px;
      border: 1px solid #aaa;
    }

    .container {
      max-width: 900px;
      margin: 30px auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      text-align: center;
    }

    #preview {
      width: 100%;
      max-height: 300px;
      object-fit: contain;
      margin-top: 15px;
      display: none;
      border-radius: 10px;
    }

    /* Upload Image Button */
    #uploadBtn {
      background: #43a047;
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 15px;
    }
    #uploadBtn:hover {
      background: #2e7d32;
    }

    .btn {
      background: #43a047;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 15px;
    }
    .btn:hover {
      background: #2e7d32;
    }

    .btn.reset-btn {
      background:#00838f;
    }
    .btn.reset-btn:hover {
      background:#006064;
    }

    .result-box {
      margin-top: 20px;
      padding: 15px;
      background: #f1f8e9;
      border-left: 5px solid #66bb6a;
      border-radius: 10px;
      display: none;
      text-align: left;
    }

    .history-box {
      margin-top: 30px;
      background: #f9fbe7;
      padding: 15px;
      border-radius: 10px;
    }
  </style>
</head>

<body>

<!-- ---------------- LOGIN / SIGNUP PAGE ---------------- -->
<div id="loginPage">
  <div class="login-box">
    <h2 id="formTitle">Login</h2>
    
    <input type="text" id="username" placeholder="Enter Username" />
    <input type="password" id="password" placeholder="Enter Password" />
    <select id="languageSelect">
      <option value="en">English</option>
      <option value="ta">தமிழ்</option>
      <option value="hi">हिंदी</option>
    </select>
    
    <button class="login-btn" id="loginBtn" onclick="login()">Login</button>
    <button class="login-btn" id="signupBtn" onclick="signup()" style="display:none;">Sign Up</button>

    <p id="toggleText">
      Don't have an account? <span style="color:#2e7d32; cursor:pointer;" onclick="toggleForm()">Sign Up</span>
    </p>
  </div>
</div>

<!-- ---------------- MAIN PAGE ---------------- -->
<div id="mainPage">
  <header>
    <img src="cropcure.jpg" alt="Logo">
    <b>CROP CURE</b>

    <!-- LANGUAGE DROPDOWN ADDED -->
    <select id="mainLanguageSelect" onchange="changeMainLanguage()">
      <option value="en">English</option>
      <option value="ta">தமிழ்</option>
      <option value="hi">हिंदी</option>
    </select>

    <button id="logoutBtn" onclick="logout()">Logout</button>
  </header>

  <div class="container">
    <h2>Upload Plant Leaf Image</h2>

    <input type="file" id="imageUpload" accept="image/*" style="display:none;" />
    <button id="uploadBtn" onclick="document.getElementById('imageUpload').click()">Upload Image</button>
    <img id="preview" />

    <button class="btn" onclick="detectDisease()">Detect Disease</button>
    <button class="btn reset-btn" onclick="resetAll()">Reset</button>

    <div class="result-box" id="resultBox">
      <h3>Disease Result:</h3>
      <p id="resultText"></p>
      <button class="btn" onclick="downloadPDF()">Download PDF</button>
    </div>

    <div class="history-box">
      <h3>History</h3>
      <ul id="historyList"></ul>
    </div>
  </div>
</div>

<!-- SOUND EFFECTS -->
<audio id="clickSound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>
<audio id="successSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<!-- JS PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  // ---------- MAIN PAGE LANGUAGE DICTIONARY ----------
  const mainLanguages = {
    en: { uploadTitle:"Upload Plant Leaf Image", detectBtn:"Detect Disease", resetBtn:"Reset", historyTitle:"History", resultTitle:"Disease Result:", downloadBtn:"Download PDF", logoutBtn:"Logout" },
    ta: { uploadTitle:"மரத்தின் இலை படம் பதிவேற்றம் செய்யவும்", detectBtn:"நோய் கண்டறி", resetBtn:"மீட்டமைக்கவும்", historyTitle:"வரலாறு", resultTitle:"நோய் முடிவு:", downloadBtn:"PDF பதிவிறக்கவும்", logoutBtn:"வெளியேறு" },
    hi: { uploadTitle:"पौधे की पत्ती की छवि अपलोड करें", detectBtn:"रोग का पता लगाएं", resetBtn:"रीसेट", historyTitle:"इतिहास", resultTitle:"रोग का परिणाम:", downloadBtn:"PDF डाउनलोड करें", logoutBtn:"लॉगआउट" }
  };

  // ---------- LOGIN / SIGNUP TOGGLE ----------
  function toggleForm() {
    const formTitle = document.getElementById("formTitle");
    const loginBtn = document.getElementById("loginBtn");
    const signupBtn = document.getElementById("signupBtn");
    const toggleText = document.getElementById("toggleText");

    if (loginBtn.style.display !== "none") {
      formTitle.innerText = "Sign Up";
      loginBtn.style.display = "none";
      signupBtn.style.display = "block";
      toggleText.innerHTML = 'Already have an account? <span style="color:#2e7d32; cursor:pointer;" onclick="toggleForm()">Login</span>';
    } else {
      formTitle.innerText = "Login";
      loginBtn.style.display = "block";
      signupBtn.style.display = "none";
      toggleText.innerHTML = 'Don\'t have an account? <span style="color:#2e7d32; cursor:pointer;" onclick="toggleForm()">Sign Up</span>';
    }
  }

  // ---------- SIGNUP ----------
  function signup() {
    let user = document.getElementById("username").value;
    let pass = document.getElementById("password").value;

    if (!user || !pass) {
      alert("Enter username and password!");
      return;
    }

    if (localStorage.getItem(user)) {
      alert("Username already exists!");
      return;
    }

    localStorage.setItem(user, pass);
    alert("Sign Up Successful! Please login.");
    toggleForm();
  }

  // ---------- LOGIN ----------
  function login() {
    let user = document.getElementById("username").value;
    let pass = document.getElementById("password").value;

    if (!user || !pass) {
      alert("Enter username and password!");
      return;
    }

    let storedPass = localStorage.getItem(user);
    if (storedPass && storedPass === pass) {
      document.getElementById("loginPage").style.display = "none";
      document.getElementById("mainPage").style.display = "block";

      // Apply language from login page to main page
      let selectedLang = document.getElementById("languageSelect").value;
      document.getElementById("mainLanguageSelect").value = selectedLang;
      changeMainLanguage();
    } else {
      alert("Invalid username or password!");
    }
  }

  // ---------- LOGOUT ----------
  function logout() {
    document.getElementById("mainPage").style.display = "none";
    document.getElementById("loginPage").style.display = "flex";
    document.getElementById("username").value = "";
    document.getElementById("password").value = "";
  }

  // ---------- CHANGE MAIN PAGE LANGUAGE ----------
  function changeMainLanguage() {
    const lang = document.getElementById("mainLanguageSelect").value;
    const dict = mainLanguages[lang];

    document.querySelector(".container h2").innerText = dict.uploadTitle;
    document.querySelector(".btn:nth-of-type(1)").innerText = dict.detectBtn;
    document.querySelector(".btn.reset-btn").innerText = dict.resetBtn;
    document.querySelector(".history-box h3").innerText = dict.historyTitle;
    document.querySelector("#resultBox h3").innerText = dict.resultTitle;
    document.querySelector("#resultBox button").innerText = dict.downloadBtn;
    document.getElementById("logoutBtn").innerText = dict.logoutBtn;
  }

  // ---------- IMAGE UPLOAD ----------
  const imageUpload = document.getElementById("imageUpload");
  const preview = document.getElementById("preview");

  imageUpload.addEventListener("change", function() {
    const file = this.files[0];
    if (file) {
      preview.src = URL.createObjectURL(file);
      preview.style.display = "block";
    }
  });

  let history = [];

  const fakeDiseases = [
    { name:"Healthy Leaf", treatment:["No treatment needed.","Monitor plant regularly."], percentage:"0%", recommendations:["Maintain watering.","Proper sunlight.","Balanced soil nutrients."] },
    { name:"Bacterial Blight", treatment:["Remove affected leaves.","Apply copper fungicide.","Ensure spacing."], percentage:"40%", recommendations:["Avoid overhead watering.","Clean tools.","Use resistant varieties."] },
    { name:"Leaf Spot", treatment:["Prune infected leaves.","Use fungicide.","Water at base."], percentage:"30%", recommendations:["Monitor humidity.","Remove debris.","Maintain spacing."] },
    { name:"Powdery Mildew", treatment:["Spray neem oil.","Remove infected leaves.","Ensure circulation."], percentage:"50%", recommendations:["Avoid crowded planting.","Increase sunlight.","Use resistant varieties."] },
    { name:"Early Blight", treatment:["Apply fungicide.","Rotate crops.","Remove debris."], percentage:"45%", recommendations:["Test soil nutrients.","Avoid wetting leaves.","Use certified seeds."] },
    { name:"Late Blight", treatment:["Remove infected plants.","Apply preventive fungicide.","Avoid overhead irrigation."], percentage:"60%", recommendations:["Keep drainage.","Monitor weather.","Balanced fertilization."] }
  ];

  function detectDisease() {
    document.getElementById("clickSound").play();
    const resultBox = document.getElementById("resultBox");
    const resultText = document.getElementById("resultText");

    if (!imageUpload.files[0]) {
      alert("Upload a leaf image first!");
      return;
    }

    resultBox.style.display = "block";
    resultText.innerHTML = "Analyzing image...";

    setTimeout(() => {
      const randomDisease = fakeDiseases[Math.floor(Math.random() * fakeDiseases.length)];
      let html = `<b>Disease:</b> ${randomDisease.name}<br><b>Effect:</b> ${randomDisease.percentage}<br><br><b>Treatment / Recommendation:</b><br>`;
      randomDisease.treatment.forEach(step => html += `<p>${step}</p>`);
      html += `<b>Additional Recommendations:</b><br>`;
      randomDisease.recommendations.forEach(rec => html += `<p>${rec}</p>`);
      resultText.innerHTML = html;

      history.push(randomDisease.name + " (" + randomDisease.percentage + ")");
      updateHistory();

      document.getElementById("successSound").play();
      alert("✔ Disease Detection Completed!");
    }, 1500);
  }

  function updateHistory() {
    let list = document.getElementById("historyList");
    list.innerHTML = "";
    history.forEach((item) => {
      let li = document.createElement("li");
      li.innerText = item;
      list.appendChild(li);
    });
  }

  function resetAll() {
    imageUpload.value = "";
    preview.src = "";
    preview.style.display = "none";

    document.getElementById("resultBox").style.display = "none";
    document.getElementById("resultText").innerText = "";

    alert("✔ Reset Completed!");
  }

  // ---------- UPDATED PDF FUNCTION (TWO PAGES) ----------
  async function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();

    // ---------- PAGE 1: Disease Info ----------
    pdf.setFontSize(18);
    pdf.text("Plant Disease Detection Report", 20, 20);

    pdf.setFontSize(14);
    pdf.text("Detected Disease & Treatment:", 20, 40);

    const lines = document.getElementById("resultText").innerText.split('\n');
    let y = 50;
    lines.forEach(line => {
      pdf.text(line, 20, y);
      y += 10;
      if (y > 270) { // Prevent text overflow
        pdf.addPage();
        y = 20;
      }
    });

    // ---------- PAGE 2: Leaf Image ----------
    pdf.addPage();

    pdf.setFontSize(18);
    pdf.text("Uploaded Leaf Image", 20, 20);

    // Resize image proportionally to fit page
    let canvas = document.createElement("canvas");
    canvas.width = preview.width;
    canvas.height = preview.height;
    let ctx = canvas.getContext("2d");
    ctx.drawImage(preview, 0, 0, canvas.width, canvas.height);
    let imgData = canvas.toDataURL("image/jpeg");

    // Fit image inside page margins
    let imgProps = pdf.getImageProperties(imgData);
    let pdfWidth = pdf.internal.pageSize.getWidth() - 40; // 20 margin left/right
    let pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

    pdf.addImage(imgData, "JPEG", 20, 30, pdfWidth, pdfHeight);

    pdf.save("Plant_Report.pdf");
  }
</script>
</body>
</html>


